<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://jeromeboyer.net/flink-studies/coding/table-api/ rel=canonical><link href=../flink-sql-2/ rel=prev><link href=../datastream/ rel=next><link rel=icon href=../../images/logo-blue.drawio.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>Table API - Apache and Confluent Flink Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#table-api class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Apache and Confluent Flink Studies" class="md-header__button md-logo" aria-label="Apache and Confluent Flink Studies" data-md-component=logo> <img src=../../images/flink-header-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Apache and Confluent Flink Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Table API </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/flink-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Foundations </a> </li> <li class=md-tabs__item> <a href=../../cookbook/ class=md-tabs__link> Cookbook </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../flink-sql-clients/ class=md-tabs__link> Flink_App_Coding </a> </li> <li class=md-tabs__item> <a href=../../methodology/data_as_a_product/ class=md-tabs__link> Methodology </a> </li> <li class=md-tabs__item> <a href=../../techno/ccloud-flink/ class=md-tabs__link> Related_Technologies </a> </li> <li class=md-tabs__item> <a href=https://jbcodeforce.github.io/eda-studies class=md-tabs__link> EDA </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Apache and Confluent Flink Studies" class="md-nav__button md-logo" aria-label="Apache and Confluent Flink Studies" data-md-component=logo> <img src=../../images/flink-header-logo.svg alt=logo> </a> Apache and Confluent Flink Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/flink-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Foundations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Foundations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/ class=md-nav__link> <span class=md-ellipsis> Flink Key Concepts </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/flink-sql/ class=md-nav__link> <span class=md-ellipsis> Flink SQL concepts </span> </a> </li> <li class=md-nav__item> <a href=../../labs/ class=md-nav__link> <span class=md-ellipsis> Code&Demos </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/agentic_flink/ class=md-nav__link> <span class=md-ellipsis> Agentic applications </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Cookbook </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cookbook/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../../cookbook/considerations/ class=md-nav__link> <span class=md-ellipsis> Considerations </span> </a> </li> <li class=md-nav__item> <a href=../../cookbook/cluster_mgt/ class=md-nav__link> <span class=md-ellipsis> Cluster management </span> </a> </li> <li class=md-nav__item> <a href=../../cookbook/job_lifecycle/ class=md-nav__link> <span class=md-ellipsis> Job Lifecycle </span> </a> </li> <li class=md-nav__item> <a href=../k8s-deploy/ class=md-nav__link> <span class=md-ellipsis> FKO & CMF Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../cookbook/terraform/ class=md-nav__link> <span class=md-ellipsis> Confluent Cloud Terraform </span> </a> </li> <li class=md-nav__item> <a href=../../techno/fk-k8s-monitor/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Flink_App_Coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Flink_App_Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> Flink SQL coding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Flink SQL coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../flink-sql-clients/ class=md-nav__link> <span class=md-ellipsis> SQL Clients </span> </a> </li> <li class=md-nav__item> <a href=../flink-sql-1/ class=md-nav__link> <span class=md-ellipsis> Create Table (SQL) </span> </a> </li> <li class=md-nav__item> <a href=../flink-sql-2/ class=md-nav__link> <span class=md-ellipsis> SQL DML </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Java - Python </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Java - Python </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Table API </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Table API </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concepts class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> <nav class=md-nav aria-label=Concepts> <ul class=md-nav__list> <li class=md-nav__item> <a href=#packaging class=md-nav__link> <span class=md-ellipsis> Packaging </span> </a> </li> <li class=md-nav__item> <a href=#confluent-specifics class=md-nav__link> <span class=md-ellipsis> Confluent Specifics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> <nav class=md-nav aria-label="Getting Started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#java class=md-nav__link> <span class=md-ellipsis> Java </span> </a> </li> <li class=md-nav__item> <a href=#python class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#code-samples class=md-nav__link> <span class=md-ellipsis> Code Samples </span> </a> <nav class=md-nav aria-label="Code Samples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#code-structure class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class=md-nav__item> <a href=#create-some-test-data class=md-nav__link> <span class=md-ellipsis> Create some test data </span> </a> </li> <li class=md-nav__item> <a href=#joining-two-tables class=md-nav__link> <span class=md-ellipsis> Joining two tables </span> </a> </li> <li class=md-nav__item> <a href=#a-deduplication-example class=md-nav__link> <span class=md-ellipsis> A deduplication example </span> </a> </li> <li class=md-nav__item> <a href=#confluent-tools-for-printing-and-stop-statement class=md-nav__link> <span class=md-ellipsis> Confluent tools for printing and stop statement </span> </a> </li> <li class=md-nav__item> <a href=#examples-of-github-repo class=md-nav__link> <span class=md-ellipsis> Examples of github repo </span> </a> </li> <li class=md-nav__item> <a href=#define-data-flows class=md-nav__link> <span class=md-ellipsis> Define data flows </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#how-to class=md-nav__link> <span class=md-ellipsis> How to </span> </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> <span class=md-ellipsis> Deeper dive </span> </a> </li> <li class=md-nav__item> <a href=#lower-level-java-based-programming-model class=md-nav__link> <span class=md-ellipsis> Lower level Java based programming model </span> </a> <nav class=md-nav aria-label="Lower level Java based programming model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#etl-with-table-api class=md-nav__link> <span class=md-ellipsis> ETL with Table API </span> </a> </li> <li class=md-nav__item> <a href=#join-with-a-kafka-streams class=md-nav__link> <span class=md-ellipsis> Join with a kafka streams </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../datastream/ class=md-nav__link> <span class=md-ellipsis> DataStreams API </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../udf_sql/ class=md-nav__link> <span class=md-ellipsis> UDFs & PTFs </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Deployment </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Deployment </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/shift_left_utils/ class=md-nav__link> <span class=md-ellipsis> Manage CC Flink projects </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> More advanced topics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> More advanced topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../stateful-func/ class=md-nav__link> <span class=md-ellipsis> Stateful function </span> </a> </li> <li class=md-nav__item> <a href=../cep/ class=md-nav__link> <span class=md-ellipsis> Complex Event Processing </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Methodology </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Methodology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../methodology/data_as_a_product/ class=md-nav__link> <span class=md-ellipsis> Data as a product </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/eda-studies/methodology/event-storming/ class=md-nav__link> <span class=md-ellipsis> Event Storming </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/shift_left_utils/ class=md-nav__link> <span class=md-ellipsis> Migrate to real-time processing tools </span> </a> </li> <li class=md-nav__item> <a href=../../methodology/coe/ class=md-nav__link> <span class=md-ellipsis> Center of Excellence </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/flink_project_demos/c360/spark_project/ class=md-nav__link> <span class=md-ellipsis> A C360 data product demo </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Related_Technologies </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Related_Technologies </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../techno/ccloud-flink/ class=md-nav__link> <span class=md-ellipsis> Confluent Cloud Flink </span> </a> </li> <li class=md-nav__item> <a href=../../techno/cp-flink/ class=md-nav__link> <span class=md-ellipsis> Confluent Platform for Flink </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/kafka/ class=md-nav__link> <span class=md-ellipsis> Kafka Integration </span> </a> </li> <li class=md-nav__item> <a href=../../techno/cc-tableflow/ class=md-nav__link> <span class=md-ellipsis> Confluent TableFlow </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/techno/data/#data-related-technologies class=md-nav__link> <span class=md-ellipsis> Apache Iceberg </span> </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/kafka-studies class=md-nav__link> <span class=md-ellipsis> Kafka-studies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/eda-studies class=md-nav__link> <span class=md-ellipsis> EDA </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#concepts class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> <nav class=md-nav aria-label=Concepts> <ul class=md-nav__list> <li class=md-nav__item> <a href=#packaging class=md-nav__link> <span class=md-ellipsis> Packaging </span> </a> </li> <li class=md-nav__item> <a href=#confluent-specifics class=md-nav__link> <span class=md-ellipsis> Confluent Specifics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> <nav class=md-nav aria-label="Getting Started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#java class=md-nav__link> <span class=md-ellipsis> Java </span> </a> </li> <li class=md-nav__item> <a href=#python class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#code-samples class=md-nav__link> <span class=md-ellipsis> Code Samples </span> </a> <nav class=md-nav aria-label="Code Samples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#code-structure class=md-nav__link> <span class=md-ellipsis> Code structure </span> </a> </li> <li class=md-nav__item> <a href=#create-some-test-data class=md-nav__link> <span class=md-ellipsis> Create some test data </span> </a> </li> <li class=md-nav__item> <a href=#joining-two-tables class=md-nav__link> <span class=md-ellipsis> Joining two tables </span> </a> </li> <li class=md-nav__item> <a href=#a-deduplication-example class=md-nav__link> <span class=md-ellipsis> A deduplication example </span> </a> </li> <li class=md-nav__item> <a href=#confluent-tools-for-printing-and-stop-statement class=md-nav__link> <span class=md-ellipsis> Confluent tools for printing and stop statement </span> </a> </li> <li class=md-nav__item> <a href=#examples-of-github-repo class=md-nav__link> <span class=md-ellipsis> Examples of github repo </span> </a> </li> <li class=md-nav__item> <a href=#define-data-flows class=md-nav__link> <span class=md-ellipsis> Define data flows </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#how-to class=md-nav__link> <span class=md-ellipsis> How to </span> </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> <span class=md-ellipsis> Deeper dive </span> </a> </li> <li class=md-nav__item> <a href=#lower-level-java-based-programming-model class=md-nav__link> <span class=md-ellipsis> Lower level Java based programming model </span> </a> <nav class=md-nav aria-label="Lower level Java based programming model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#etl-with-table-api class=md-nav__link> <span class=md-ellipsis> ETL with Table API </span> </a> </li> <li class=md-nav__item> <a href=#join-with-a-kafka-streams class=md-nav__link> <span class=md-ellipsis> Join with a kafka streams </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=table-api>Table API<a class=headerlink href=#table-api title="Permanent link">&para;</a></h1> <details class="- info"> <summary>Update</summary> <p>Created 10/2024 - Updated 11/03/24. Reorganize in improve documentation 10/2025</p> </details> <h2 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h2> <p>The <a href=https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/overview/ >TableAPI</a> serves as the lower-level API for executing Flink SQL, allowing for stream processing implementations in Java and Python. The Table API encapsulates a stream or a physical table, enabling developers to implement streaming processing by programming against these tables.</p> <p><a href=https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/common/ >See the main concepts</a> and APIs. The structure of a program looks mostly the same:</p> <ol> <li>Create a TableEnvironment for batch or streaming execution <div class="language-java highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.EnvironmentSettings</span><span class=p>;</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.TableEnvironment</span><span class=p>;</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>EnvironmentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EnvironmentSettings</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=p>.</span><span class=na>newInstance</span><span class=p>()</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span><span class=p>.</span><span class=na>inStreamingMode</span><span class=p>()</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=c1>//.inBatchMode()</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>    </span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=n>TableEnvironment</span><span class=w> </span><span class=n>tEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span>
</span></code></pre></div></li> <li>Create one or more source table(s)</li> <li>Create one or more sink Tables(s) or use the print sink</li> <li>Create processing logic using SQL string or Table API functions</li> </ol> <p>Summary of important concepts:</p> <ul> <li>The main function is a Flink client, that will compiles the code into a dataflow graph and submots to the JobManager.</li> <li>A TableEnvironment maintains a map of catalogs of tables </li> <li>Tables can be either virtual (VIEWS) or regular TABLES which describe external data.</li> <li>Tables may be temporary (tied to the lifecycle of a single Flink session), or permanent ( visible across multiple Flink sessions and clusters).</li> <li>Temportary table may shadow a permanent table.</li> <li>Tables are always registered with a 3-part identifier consisting of catalog, database, and table name.</li> <li>TableSink is a <a href=https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/common/#emit-a-table>generic interface to to write</a> results to. A batch Table can only be written to a <code>BatchTableSink</code>, while a streaming Table requires either an <code>AppendStreamTableSink</code>, a <code>RetractStreamTableSink</code>, or an <code>UpsertStreamTableSink</code>.</li> <li>A pipeline can be explained with <code>TablePipeline.explain()</code> and executed invoking <code>TablePipeline.execute()</code>.</li> <li>Recall that High-Availability in Application Mode is only supported for single-execute() applications.</li> </ul> <p>It is important to note that Table API and SQL queries can be easily integrated with and embedded into DataStream programs.</p> <h3 id=packaging>Packaging<a class=headerlink href=#packaging title="Permanent link">&para;</a></h3> <p>TBD</p> <h3 id=confluent-specifics>Confluent Specifics<a class=headerlink href=#confluent-specifics title="Permanent link">&para;</a></h3> <p>In Confluent Manager for Flink deployment, only Flink Application mode is supported. A <strong>Flink Application</strong> is any user's program that spawns one or multiple Flink jobs from its <code>main()</code> method. The execution of these jobs can happen in a local JVM (LocalEnvironment) or on a remote setup of clusters with multiple machines (<a href=../k8s-deploy/ >kubernetes</a>).</p> <p>In the context of <strong>Confluent Cloud</strong>, the Table API program acts as a client-side library for interacting with the Flink engine hosted in the cloud. It enables the submission of <code>Statements</code> and retrieval of <code>StatementResults</code>. The provided Confluent plugin integrates specific components for configuring the TableEnvironment, eliminating the need for a local Flink cluster. By including the <code>confluent-flink-table-api-java-plugin</code> dependency, Flink's internal componentsâ€”such as CatalogStore, Catalog, Planner, Executor, and configuration, are managed by the plugin and fully integrated with Confluent Cloud. This integration is via the REST API, so Confluent Table API plugin is an higher emcapsulation of the CC REST API. </p> <h2 id=getting-started>Getting Started<a class=headerlink href=#getting-started title="Permanent link">&para;</a></h2> <p>The development approach includes at least the following steps:</p> <ol> <li> <p>Create a maven project with a command like: <div class="language-sh highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>mvn<span class=w> </span>archetype:generate<span class=w> </span>-DgroupId<span class=o>=</span>j9r.flink<span class=w> </span>-DartifactId<span class=o>=</span>my-app<span class=w> </span>-DarchetypeArtifactId<span class=o>=</span>maven-archetype-quickstart<span class=w> </span>-DarchetypeVersion<span class=o>=</span><span class=m>1</span>.5<span class=w> </span>-DinteractiveMode<span class=o>=</span><span class=nb>false</span>
</span></code></pre></div></p> </li> <li> <p>Add the flink table api, and Kafka client dependencies:</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1><strong>Open Source Libraries</strong></label><label for=__tabbed_1_2><strong>Confluent Cloud for Flink</strong></label><label for=__tabbed_1_3><strong>Confluent Platform for Flink</strong></label></div> <div class=tabbed-content> <div class=tabbed-block> <p><div class="language-xml highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=nt>&lt;artifactId&gt;</span>flink-java<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nt>&lt;artifactId&gt;</span>flink-clients<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=nt>&lt;artifactId&gt;</span>flink-table-api-java<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=nt>&lt;artifactId&gt;</span>flink-table-common<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=nt>&lt;artifactId&gt;</span>flink-table-api-java-bridge<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=nt>&lt;artifactId&gt;</span>flink-table-runtime<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=nt>&lt;artifactId&gt;</span>flink-connector-kafka<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=nt>&lt;artifactId&gt;</span>flink-connector-base<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=cm>&lt;!-- Depending of the serialization needs --&gt;</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=nt>&lt;artifactId&gt;</span>flink-json<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=nt>&lt;artifactId&gt;</span>flink-avro<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=cm>&lt;!-- when using schema registry --&gt;</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a><span class=nt>&lt;artifactId&gt;</span>flink-avro-confluent-registry<span class=nt>&lt;/artifactId&gt;</span>
</span></code></pre></div> (see an example of <a href=https://github.com/jbcodeforce/flink-studies/tree/master/e2e-demos/e-com-sale/flink-app/pom.xml>pom.xml</a>). Use <code>provided</code> dependencies to get the Flink jars from the deployed product. </p> </div> <div class=tabbed-block> <p><div class="language-xml highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=w> </span><span class=nt>&lt;dependency&gt;</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=nt>&lt;groupId&gt;</span>io.confluent.flink<span class=nt>&lt;/groupId&gt;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=nt>&lt;artifactId&gt;</span>confluent-flink-table-api-java-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>    </span><span class=nt>&lt;version&gt;</span>${confluent-plugin.version}<span class=nt>&lt;/version&gt;</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=nt>&lt;/dependency&gt;</span>
</span></code></pre></div> For <ins>Confluent Cloud for Flink deployment</ins> see the <a href=https://github.com/jbcodeforce/flink-studies/blob/master/code/table-api/ccf-table-api/pom.xml>pom.xml in table-api/ccf-table-api</a> folder.</p> </div> <div class=tabbed-block> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>
</span></code></pre></div> </div> </div> </div> </li> <li> <p>Implement and unit test the flow. See best practices for <a href=#code-structure>code structure</a>.</p> </li> <li> <p>Depending of the target Flink runtime, there will be different steps: </p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>For <strong>Confluent Platform for Flink</strong>:</label><label for=__tabbed_2_2>For <strong>Confluent Cloud for Flink</strong>:</label></div> <div class=tabbed-content> <div class=tabbed-block> <ol> <li>Define a FlinkApplication CR</li> <li>Package the jar, and build a docker image using Confluent Platform for Flink base image with a copy of the app jar. (See example of <a href=https://github.com/jbcodeforce/flink-studies/tree/master/e2e-demos/e-com-sale/flink-app/Dockerfile>Dockerfile</a>)</li> <li>Deploy to Kubernetes using the Flink kubernetes operator</li> <li>Monitor with the web ui.</li> </ol> </div> <div class=tabbed-block></div> </div> </div> <ol> <li> <p>Add the <code>io.confluent.flink.confluent-flink-table-api-java-plugin</code> into the maven dependencies and use the following Environment settings: </p> <div class="language-java highlight"><span class=filename>Confluent Cloud access via environment variables</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>import</span><span class=w> </span><span class=nn>io.confluent.flink.plugin.ConfluentSettings</span><span class=p>;</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.EnvironmentSettings</span><span class=p>;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=n>EnvironmentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ConfluentSettings</span><span class=p>.</span><span class=na>fromGlobalVariables</span><span class=p>();</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=n>TableEnvironment</span><span class=w> </span><span class=n>env</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span>
</span></code></pre></div> <div class="language-java highlight"><span class=filename>Confluent Cloud access via properties file</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>import</span><span class=w> </span><span class=nn>io.confluent.flink.plugin.ConfluentSettings</span><span class=p>;</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.EnvironmentSettings</span><span class=p>;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=n>EnvironmentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ConfluentSettings</span><span class=p>.</span><span class=na>fromResource</span><span class=p>(</span><span class=s>&quot;/cloud.properties&quot;</span><span class=p>);</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>TableEnvironment</span><span class=w> </span><span class=n>env</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span>
</span></code></pre></div> <p>When using private endpoint, there is a need to be at the 1.20.50 version of the plugin (<code>confluent_flink_table_api_python_plugin="&gt;=1.20.50"</code>) and use code (python example) like:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>settings</span> <span class=o>=</span> <span class=n>ConfluentSettings</span><span class=o>.</span><span class=n>new_builder_from_file</span><span class=p>(</span><span class=n>CLOUD_PROPERTIES_PATH</span><span class=p>)</span> 
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=o>.</span><span class=n>set_context_name</span><span class=p>(</span><span class=s2>&quot;my-context&quot;</span><span class=p>)</span> 
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=o>.</span><span class=n>set_rest_endpoint</span><span class=p>(</span><span class=s2>&quot;private.confluent.cloud&quot;</span><span class=p>)</span> 
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=o>.</span><span class=n>build</span><span class=p>()</span>
</span></code></pre></div> </li> <li> <p>Set environment variables to specify API key and secrets, Confluent Cloud environment, compute pool... </p> <div class="language-sh highlight"><span class=filename>Confluent Cloud related environment variables</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nb>export</span><span class=w> </span><span class=nv>CLOUD_PROVIDER</span><span class=o>=</span><span class=s2>&quot;aws&quot;</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=nb>export</span><span class=w> </span><span class=nv>CLOUD_REGION</span><span class=o>=</span><span class=s2>&quot;us-west-2&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nb>export</span><span class=w> </span><span class=nv>FLINK_API_KEY</span><span class=o>=</span><span class=s2>&quot;&lt;your-flink-api-key&gt;&quot;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=nb>export</span><span class=w> </span><span class=nv>FLINK_API_SECRET</span><span class=o>=</span><span class=s2>&quot;&lt;your-flink-api-secret&gt;&quot;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nb>export</span><span class=w> </span><span class=nv>ORG_ID</span><span class=o>=</span><span class=s2>&quot;&lt;your-organization-id&gt;&quot;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=nb>export</span><span class=w> </span><span class=nv>ENV_ID</span><span class=o>=</span><span class=s2>&quot;&lt;your-environment-id&gt;&quot;</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=nb>export</span><span class=w> </span><span class=nv>COMPUTE_POOL_ID</span><span class=o>=</span><span class=s2>&quot;&lt;your-compute-pool-id&gt;&quot;</span>
</span></code></pre></div> </li> <li> <p>Execute the java program</p> </li> </ol> </li> </ol> <p>See <a href=https://github.com/confluentinc/flink-cookbook>the Confluent Flink cookbook</a> for more Table API and DataStream examples.</p> <h3 id=java>Java<a class=headerlink href=#java title="Permanent link">&para;</a></h3> <p>Any main function needs to connect to the Flink environment. Confluent API offers a way to read cloud client properties so the running Flink application can access the Job and Task managers running in the Confluent Cloud compute pools as a service (see code example above).</p> <p>A <a href=https://nightlies.apache.org/flink/flink-docs-stable/api/java/org/apache/flink/table/api/TableEnvironment.html>table environment</a> is the base class, entry point, and central context for creating Table and SQL API programs. </p> <p>TableEnvironment uses an <code>EnvironmentSettings</code> that define the execution mode. The following is a template code to run Table API program submitted to a Job Manager deployed locally or on Kubernetes (OSS Flink or CP for Flink):</p> <div class="language-java highlight"><span class=filename>Deployment for Kubernetes or local</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>settings</span><span class=o>=</span><span class=w> </span><span class=n>EnvironmentSettings</span><span class=p>.</span><span class=na>newInstance</span><span class=p>()</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>   </span><span class=p>.</span><span class=na>inStreamingMode</span><span class=p>()</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>   </span><span class=p>.</span><span class=na>withBuiltInCatalogName</span><span class=p>(</span><span class=s>&quot;default_catalog&quot;</span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>   </span><span class=p>.</span><span class=na>withBuiltInDatabaseName</span><span class=p>(</span><span class=s>&quot;default_database&quot;</span><span class=p>)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>   </span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>TableEnvironment</span><span class=w> </span><span class=n>tableEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>        </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>get_config</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=s>&quot;parallelism.default&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;4&quot;</span><span class=p>);</span>
</span></code></pre></div> <p>Once packaged with maven as a uber-jar the application may be executed locally to send the dataflow to the Confluent Cloud for Flink JobManager or can be deployed as a <code>FlinkApplication</code> within a k8s cluster. </p> <h4 id=confluent-cloud-for-flink-execution>Confluent Cloud for Flink execution<a class=headerlink href=#confluent-cloud-for-flink-execution title="Permanent link">&para;</a></h4> <p>When using remote Confluent Cloud for Flink, it is possible to directly execute the java jar and it will send the DAG to the remote job manager:</p> <div class="language-sh highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># set all environment variable or use /cloud.properties in resource folder</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>java<span class=w> </span>-jar<span class=w> </span>target/flink-app-ecom-0.1.0.jar<span class=w> </span>
</span></code></pre></div> <p>See <a href=https://github.com/jbcodeforce/flink-studies/blob/master/code/table-api/java-table-api/src/main/java/flink/examples/table/Main_00_JoinOrderCustomer.java>code sample: Main_00_JoinOrderCustomer.java</a></p> <p>Get the catalog and databases, and use the environment to get the list of tables. In Confluent Cloud, there is a predefined catalog with some table samples: <code>examples.marketplace</code>.</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=err>#</span><span class=w> </span><span class=n>using</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=n>string</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>env</span><span class=p>.</span><span class=na>executeSql</span><span class=p>(</span><span class=s>&quot;SHOW TABLES IN `examples`.`marketplace`&quot;</span><span class=p>).</span><span class=na>print</span><span class=p>();</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=err>#</span><span class=w> </span><span class=n>or</span><span class=w> </span><span class=n>using</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>api</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=n>env</span><span class=p>.</span><span class=na>useCatalog</span><span class=p>(</span><span class=s>&quot;examples&quot;</span><span class=p>);</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=n>env</span><span class=p>.</span><span class=na>useDatabase</span><span class=p>(</span><span class=s>&quot;marketplace&quot;</span><span class=p>);</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>env</span><span class=p>.</span><span class=na>listTables</span><span class=p>()).</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=err>#</span><span class=w> </span><span class=n>work</span><span class=w> </span><span class=n>on</span><span class=w> </span><span class=n>one</span><span class=w> </span><span class=n>table</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=n>env</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=s>&quot;`customers`&quot;</span><span class=p>).</span><span class=na>printSchema</span><span class=p>();</span>
</span></code></pre></div> <h3 id=python>Python<a class=headerlink href=#python title="Permanent link">&para;</a></h3> <h2 id=code-samples>Code Samples<a class=headerlink href=#code-samples title="Permanent link">&para;</a></h2> <p>The important classes are:</p> <ul> <li><a href=https://nightlies.apache.org/flink/flink-docs-release-1.20/api/java/org/apache/flink/table/api/TableEnvironment.html>TableEnvironment</a></li> <li><a href=https://nightlies.apache.org/flink/flink-docs-release-1.20/api/java/org/apache/flink/table/api/Table.html>Table</a></li> <li><a href=https://nightlies.apache.org/flink/flink-docs-release-1.20/api/java/org/apache/flink/types/Row.html>Row</a></li> <li><a href=https://nightlies.apache.org/flink/flink-docs-release-1.20/api/java/org/apache/flink/table/api/Expressions.html>Expressions</a> contains static methods for referencing table columns, creating literals, and building more complex Expression chains. See below.</li> <li><a href=//github.com/confluentinc/flink-table-api-java-examples.git>Confluent Table API Tutorial</a></li> </ul> <h3 id=code-structure>Code structure<a class=headerlink href=#code-structure title="Permanent link">&para;</a></h3> <p>Clearly separate the creation of sources, sinks, workflow in different methods. References those methods in the main().</p> <h3 id=create-some-test-data>Create some test data<a class=headerlink href=#create-some-test-data title="Permanent link">&para;</a></h3> <p>Use one of the TableEnvironment fromValues() methods,</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>From collection</label><label for=__tabbed_3_2>With Schema and list of row</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-java highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>env</span><span class=p>.</span><span class=na>fromValues</span><span class=p>(</span><span class=s>&quot;Paul&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Jerome&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Peter&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Robert&quot;</span><span class=p>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>                </span><span class=p>.</span><span class=na>as</span><span class=p>(</span><span class=s>&quot;name&quot;</span><span class=p>)</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>                </span><span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>$</span><span class=p>(</span><span class=s>&quot;name&quot;</span><span class=p>).</span><span class=na>like</span><span class=p>(</span><span class=s>&quot;%e%&quot;</span><span class=p>))</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>                </span><span class=p>.</span><span class=na>execute</span><span class=p>()</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>                </span><span class=p>.</span><span class=na>print</span><span class=p>();</span>
</span></code></pre></div> </div> <div class=tabbed-block> <div class="language-java highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.DataTypes</span><span class=p>;</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=n>Table</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>env</span><span class=p>.</span><span class=na>fromValues</span><span class=p>(</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>                        </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>ROW</span><span class=p>(</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>                                </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>FIELD</span><span class=p>(</span><span class=s>&quot;customer_id&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>INT</span><span class=p>()),</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>                                </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>FIELD</span><span class=p>(</span><span class=s>&quot;name&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>()),</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>                                </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>FIELD</span><span class=p>(</span><span class=s>&quot;email&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>())),</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>                        </span><span class=n>row</span><span class=p>(</span><span class=mi>3160</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Bob&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;bob@corp.com&quot;</span><span class=p>),</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>                        </span><span class=n>row</span><span class=p>(</span><span class=mi>3107</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Alice&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;alice.smith@example.org&quot;</span><span class=p>),</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>                        </span><span class=n>row</span><span class=p>(</span><span class=mi>3248</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Robert&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;robert@someinc.com&quot;</span><span class=p>));</span>
</span></code></pre></div> </div> </div> </div> <h3 id=joining-two-tables>Joining two tables<a class=headerlink href=#joining-two-tables title="Permanent link">&para;</a></h3> <p>See the example in <a href=https://github.com/jbcodeforce/flink-studies/tree/master/flink-java/table-api-java/src/main/java/flink/examples/table/00_join_order_customer.java>00_join_order_customer.java</a>. The statements may run forever. </p> <h3 id=a-deduplication-example>A deduplication example<a class=headerlink href=#a-deduplication-example title="Permanent link">&para;</a></h3> <p>The deduplication of record over a time window is a classical pattern. See this SQL query with the following Table API implementation</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=n>Table</span><span class=w> </span><span class=n>source</span><span class=p>;</span>
</span></code></pre></div> <h3 id=confluent-tools-for-printing-and-stop-statement>Confluent tools for printing and stop statement<a class=headerlink href=#confluent-tools-for-printing-and-stop-statement title="Permanent link">&para;</a></h3> <p><a href=https://github.com/confluentinc/flink-table-api-java-examples/blob/master/README.md#documentation-for-confluent-utilities>See this git repository</a></p> <h3 id=examples-of-github-repo>Examples of github repo<a class=headerlink href=#examples-of-github-repo title="Permanent link">&para;</a></h3> <ul> <li><a href=https://github.com/twalthr/flink-api-examples>Timo Walther's flink api examples in Java</a></li> </ul> <hr> <h3 id=define-data-flows>Define data flows<a class=headerlink href=#define-data-flows title="Permanent link">&para;</a></h3> <p>A TablePipeline describes a flow of data from source(s) to sink. We can also use </p> <p>The pipeline flow can use different services, defined in separate Java classes. Those classes may be reusable. The environment needs to be passed to each service, as this is the environment which includes all the Table API functions.</p> <p>Some code is in <a href=https://github.com/jbcodeforce/flink-studies/tree/master/flink-java/table-api>this folder</a>.</p> <h2 id=how-to>How to<a class=headerlink href=#how-to title="Permanent link">&para;</a></h2> <details class="- question"> <summary>Create a data generator</summary> <p>There is the <a href=https://github.com/knaufk/flink-faker>FlinkFaker tool</a> that seems to be very efficient to send different types of data. It is using <a href=https://www.datafaker.net/documentation/getting-started/ >Datafaker</a> Java library, which can be extended to add our own data provider. FlinkFaker jar is added to the custom flink image in the Dockerfile. The challenges will be to remote connect to the compute-pool as defined in Confluent Cloud.</p> </details> <details class="- question"> <summary>Connect to Confluent Cloud remotely</summary> <p>Define the cloud.properties and then use the Confluent API</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=w>    </span><span class=kn>import</span><span class=w> </span><span class=nn>io.confluent.flink.plugin.ConfluentSettings</span><span class=p>;</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.EnvironmentSettings</span><span class=p>;</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.TableEnvironment</span><span class=p>;</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>        </span><span class=n>EnvironmentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ConfluentSettings</span><span class=p>.</span><span class=na>fromResource</span><span class=p>(</span><span class=s>&quot;/cloud.properties&quot;</span><span class=p>);</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>        </span><span class=n>TableEnvironment</span><span class=w> </span><span class=n>env</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>settings</span><span class=p>);</span>
</span></code></pre></div> <p>With environment variables</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>ConfluentSettings</span><span class=w> </span><span class=n>settings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ConfluentSettings</span><span class=p>.</span><span class=na>fromGlobalVariables</span><span class=p>();</span>
</span></code></pre></div> </details> <details class="- question"> <summary>Create a table with Kafka topic as persistence in Confluent Cloud?</summary> <div class="language-java highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=kn>import</span><span class=w> </span><span class=nn>io.confluent.flink.plugin.ConfluentSettings</span><span class=p>;</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=kn>import</span><span class=w> </span><span class=nn>io.confluent.flink.plugin.ConfluentTableDescriptor</span><span class=p>;</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=c1>//...</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=n>env</span><span class=p>.</span><span class=na>createTable</span><span class=p>(</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>        </span><span class=n>TARGET_TABLE1</span><span class=p>,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>        </span><span class=n>ConfluentTableDescriptor</span><span class=p>.</span><span class=na>forManaged</span><span class=p>()</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>            </span><span class=p>.</span><span class=na>schema</span><span class=p>(</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>                    </span><span class=n>Schema</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>                            </span><span class=p>.</span><span class=na>column</span><span class=p>(</span><span class=s>&quot;user_id&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>())</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>                            </span><span class=p>.</span><span class=na>column</span><span class=p>(</span><span class=s>&quot;name&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>())</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>                            </span><span class=p>.</span><span class=na>column</span><span class=p>(</span><span class=s>&quot;email&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>())</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>            </span><span class=p>.</span><span class=na>distributedBy</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s>&quot;user_id&quot;</span><span class=p>)</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>            </span><span class=p>.</span><span class=na>option</span><span class=p>(</span><span class=s>&quot;kafka.retention.time&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;0&quot;</span><span class=p>)</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>            </span><span class=p>.</span><span class=na>option</span><span class=p>(</span><span class=s>&quot;key.format&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;json-registry&quot;</span><span class=p>)</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>            </span><span class=p>.</span><span class=na>option</span><span class=p>(</span><span class=s>&quot;value.format&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;json-registry&quot;</span><span class=p>)</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>());</span>
</span></code></pre></div> </details> <details class="- question"> <summary>Access to the schema of an existing topic / table?</summary> <div class="language-java highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.flink.table.api.DataTypes</span><span class=p>;</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=c1>//...</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=n>DataType</span><span class=w> </span><span class=n>productsRow</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>env</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=s>&quot;examples.marketplace.products&quot;</span><span class=p>)</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>                </span><span class=p>.</span><span class=na>getResolvedSchema</span><span class=p>()</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>                </span><span class=p>.</span><span class=na>toPhysicalRowDataType</span><span class=p>();</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>columnNames</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DataType</span><span class=p>.</span><span class=na>getFieldNames</span><span class=p>(</span><span class=n>productsRow</span><span class=p>);</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=n>List</span><span class=o>&lt;</span><span class=n>DataType</span><span class=o>&gt;</span><span class=w> </span><span class=n>columnTypes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DataType</span><span class=p>.</span><span class=na>getFieldDataTypes</span><span class=p>(</span><span class=n>productsRow</span><span class=p>);</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=c1>// use in the schema function to create a new topic ...</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>        </span><span class=n>Schema</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=w>                </span><span class=p>.</span><span class=na>fromFields</span><span class=p>(</span><span class=n>columnNames</span><span class=p>,</span><span class=w> </span><span class=n>columnTypes</span><span class=p>)</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=w>                </span><span class=p>.</span><span class=na>column</span><span class=p>(</span><span class=s>&quot;additionalColumn&quot;</span><span class=p>,</span><span class=w> </span><span class=n>DataTypes</span><span class=p>.</span><span class=na>STRING</span><span class=p>())</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>()</span>
</span></code></pre></div> </details> <details class="- question"> <summary>How to split records to two topic, using StatementSet?</summary> <div class="language-java highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>StatementSet</span><span class=w> </span><span class=n>statementSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>env</span><span class=p>.</span><span class=na>createStatementSet</span><span class=p>()</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>                    </span><span class=p>.</span><span class=na>add</span><span class=p>(</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>                        </span><span class=n>env</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=s>&quot;`examples`.`marketplace`.`orders`&quot;</span><span class=p>)</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>                           </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>$</span><span class=p>(</span><span class=s>&quot;product_id&quot;</span><span class=p>),</span><span class=w> </span><span class=n>$</span><span class=p>(</span><span class=s>&quot;price&quot;</span><span class=p>))</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>                           </span><span class=p>.</span><span class=na>insertInto</span><span class=p>(</span><span class=s>&quot;PricePerProduct&quot;</span><span class=p>))</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>                    </span><span class=p>.</span><span class=na>add</span><span class=p>(</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>                        </span><span class=n>env</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=s>&quot;`examples`.`marketplace`.`orders`&quot;</span><span class=p>)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>                           </span><span class=p>.</span><span class=na>select</span><span class=p>(</span><span class=n>$</span><span class=p>(</span><span class=s>&quot;customer_id&quot;</span><span class=p>),</span><span class=w> </span><span class=n>$</span><span class=p>(</span><span class=s>&quot;price&quot;</span><span class=p>))</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>                           </span><span class=p>.</span><span class=na>insertInto</span><span class=p>(</span><span class=s>&quot;PricePerCustomer&quot;</span><span class=p>));</span>
</span></code></pre></div> </details> <h2 id=deeper-dive>Deeper dive<a class=headerlink href=#deeper-dive title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/confluentinc/learn-apache-flink-table-api-for-java-exercises>See this git repo: Learn-apache-flink-table-api-for-java-exercises</a>. </li> <li>See the <a href=https://docs.confluent.io/cloud/current/flink/reference/table-api.html>Table API in Java documentation</a>.</li> <li><a href=https://developer.confluent.io/courses/flink-table-api-java/exercise-connecting-to-confluent-cloud/ >Connecting the Apache Flink Table API to Confluent Cloud</a> with matching <a href=https://github.com/confluentinc/learn-apache-flink-table-api-for-java-exercises>github</a> which part of this code was ported into <a href=https://github.com/jbcodeforce/flink-studies/tree/master/flink-sql-demos/02-table-api-java>flink-sql-demos/02-table-api-java</a></li> </ul> <hr> <p>TO WORK ON</p> <h2 id=lower-level-java-based-programming-model>Lower level Java based programming model<a class=headerlink href=#lower-level-java-based-programming-model title="Permanent link">&para;</a></h2> <ul> <li>Start Flink server using docker (<a href=../getting-started/#docker-compose-with-kafka>start with docker compose</a> or on <a href=../k8s-deploy/ >Kubernetes</a>). </li> <li>Start by creating a java application (quarkus create app for example or using maven) and a Main class. See code in <a href=https://github.com/jbcodeforce/flink-studies/blob/master/flink-sql/flink-sql-quarkus/ >flink-sql-quarkus</a> folder.</li> <li>Add dependencies in the pom</li> </ul> <div class="language-xml highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=w>      </span><span class=nt>&lt;dependency&gt;</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>        </span><span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>        </span><span class=nt>&lt;artifactId&gt;</span>flink-table-api-java-bridge<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>        </span><span class=nt>&lt;version&gt;</span>${flink-version}<span class=nt>&lt;/version&gt;</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>      </span><span class=nt>&lt;/dependency&gt;</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>        </span><span class=nt>&lt;dependency&gt;</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>        </span><span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>        </span><span class=nt>&lt;artifactId&gt;</span>flink-table-runtime<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>        </span><span class=nt>&lt;version&gt;</span>${flink-version}<span class=nt>&lt;/version&gt;</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>        </span><span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=w>      </span><span class=nt>&lt;/dependency&gt;</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>      </span><span class=nt>&lt;dependency&gt;</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>        </span><span class=nt>&lt;groupId&gt;</span>org.apache.flink<span class=nt>&lt;/groupId&gt;</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>        </span><span class=nt>&lt;artifactId&gt;</span>flink-table-planner-loader<span class=nt>&lt;/artifactId&gt;</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=w>        </span><span class=nt>&lt;version&gt;</span>${flink-version}<span class=nt>&lt;/version&gt;</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>        </span><span class=nt>&lt;scope&gt;</span>provided<span class=nt>&lt;/scope&gt;</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>      </span><span class=nt>&lt;/dependency&gt;</span>
</span></code></pre></div> <div class="language-java highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>FirstSQLApp</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w> </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>        </span><span class=n>StreamExecutionEnvironment</span><span class=w> </span><span class=n>env</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StreamExecutionEnvironment</span><span class=p>.</span><span class=na>getExecutionEnvironment</span><span class=p>();</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>        </span><span class=n>StreamTableEnvironment</span><span class=w> </span><span class=n>tableEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StreamTableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>env</span><span class=p>);</span>
</span></code></pre></div> <p>The <code>TableEnvironment</code> is the entrypoint for Table API and SQL integration. See <a href=https://nightlies.apache.org/flink/flink-docs-release-1.19/docs/dev/table/common/#create-a-tableenvironment>Create Table environment</a></p> <p>A TableEnvironment maintains a map of catalogs of tables which are created with an identifier. Each identifier consists of 3 parts: catalog name, database name and object name.</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=w>    </span><span class=c1>// build a dynamic view from a stream and specifies the fields. here one field only</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>    </span><span class=n>Table</span><span class=w> </span><span class=n>inputTable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>fromDataStream</span><span class=p>(</span><span class=n>dataStream</span><span class=p>).</span><span class=na>as</span><span class=p>(</span><span class=s>&quot;name&quot;</span><span class=p>);</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=c1>// register the Table object in default catalog and database, as a view and query it</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>    </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>createTemporaryView</span><span class=p>(</span><span class=s>&quot;clickStreamsView&quot;</span><span class=p>,</span><span class=w> </span><span class=n>inputTable</span><span class=p>);</span>
</span></code></pre></div> <p><img alt src=../../architecture/diagrams/sql-concepts.drawio.png></p> <p>Tables can be either temporary, tied to the lifecycle of a single Flink session, or permanent, making them visible across multiple Flink sessions and clusters.</p> <p>Queries such as SELECT ... FROM ... WHERE which only consist of field projections or filters are usually stateless pipelines. However, operations such as joins, aggregations, or deduplications require keeping intermediate results in a fault-tolerant storage for which Flinkâ€™s state abstractions are used.</p> <h3 id=etl-with-table-api>ETL with Table API<a class=headerlink href=#etl-with-table-api title="Permanent link">&para;</a></h3> <p>See code: <a href=https://github.com/jbcodeforce/flink-studies/blob/master/flink-sql-quarkus/src/test/java/org/acme/TableToJson.java>TableToJson</a></p> <div class="language-java highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>        </span><span class=n>StreamExecutionEnvironment</span><span class=w> </span><span class=n>streamEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StreamExecutionEnvironment</span><span class=p>.</span><span class=na>getExecutionEnvironment</span><span class=p>();</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>        </span><span class=n>StreamTableEnvironment</span><span class=w> </span><span class=n>tableEnv</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>StreamTableEnvironment</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>streamEnv</span><span class=p>);</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>        </span><span class=kd>final</span><span class=w> </span><span class=n>Table</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>fromValues</span><span class=p>(</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>            </span><span class=n>row</span><span class=p>(</span><span class=mi>12L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Alice&quot;</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1984</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>12</span><span class=p>)),</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>            </span><span class=n>row</span><span class=p>(</span><span class=mi>32L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Bob&quot;</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1990</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>)),</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>            </span><span class=n>row</span><span class=p>(</span><span class=mi>7L</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Kyle&quot;</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1979</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>23</span><span class=p>)))</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>        </span><span class=p>.</span><span class=na>as</span><span class=p>(</span><span class=s>&quot;c_id&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;c_name&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;c_birthday&quot;</span><span class=p>)</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>        </span><span class=p>.</span><span class=na>select</span><span class=p>(</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>                </span><span class=n>jsonObject</span><span class=p>(</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>                </span><span class=n>JsonOnNull</span><span class=p>.</span><span class=na>NULL</span><span class=p>,</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>                    </span><span class=s>&quot;name&quot;</span><span class=p>,</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>                    </span><span class=n>$</span><span class=p>(</span><span class=s>&quot;c_name&quot;</span><span class=p>),</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>                    </span><span class=s>&quot;age&quot;</span><span class=p>,</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>                    </span><span class=n>timestampDiff</span><span class=p>(</span><span class=n>TimePointUnit</span><span class=p>.</span><span class=na>YEAR</span><span class=p>,</span><span class=w> </span><span class=n>$</span><span class=p>(</span><span class=s>&quot;c_birthday&quot;</span><span class=p>),</span><span class=w> </span><span class=n>currentDate</span><span class=p>())</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>                </span><span class=p>)</span>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a><span class=w>        </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>toChangelogStream</span><span class=p>(</span><span class=n>t</span><span class=p>).</span><span class=na>print</span><span class=p>();</span>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=w>        </span><span class=n>streamEnv</span><span class=p>.</span><span class=na>execute</span><span class=p>();</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=p>}</span>
</span></code></pre></div> <h3 id=join-with-a-kafka-streams>Join with a kafka streams<a class=headerlink href=#join-with-a-kafka-streams title="Permanent link">&para;</a></h3> <p>Join transactions coming from Kafka topic with customer information.</p> <div class="language-java highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=w>    </span><span class=c1>// customers is reference data loaded from file or DB connector</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>    </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>createTemporaryView</span><span class=p>(</span><span class=s>&quot;Customers&quot;</span><span class=p>,</span><span class=w> </span><span class=n>customerStream</span><span class=p>);</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=c1>// transactions come from kafka</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=n>DataStream</span><span class=o>&lt;</span><span class=n>Transaction</span><span class=o>&gt;</span><span class=w> </span><span class=n>transactionStream</span><span class=w> </span><span class=o>=</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>        </span><span class=n>env</span><span class=p>.</span><span class=na>fromSource</span><span class=p>(</span><span class=n>transactionSource</span><span class=p>,</span><span class=w> </span><span class=n>WatermarkStrategy</span><span class=p>.</span><span class=na>noWatermarks</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;Transactions&quot;</span><span class=p>);</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=n>tableEnv</span><span class=p>.</span><span class=na>createTemporaryView</span><span class=p>(</span><span class=s>&quot;Transactions&quot;</span><span class=p>,</span><span class=w> </span><span class=n>transactionStream</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=n>tableEnv</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>        </span><span class=p>.</span><span class=na>executeSql</span><span class=p>(</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>            </span><span class=s>&quot;SELECT c_name, CAST(t_amount AS DECIMAL(5, 2))\n&quot;</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>                </span><span class=o>+</span><span class=w> </span><span class=s>&quot;FROM Customers\n&quot;</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>                </span><span class=o>+</span><span class=w> </span><span class=s>&quot;JOIN (SELECT DISTINCT * FROM Transactions) ON c_id = t_customer_id&quot;</span><span class=p>)</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>        </span><span class=p>.</span><span class=na>print</span><span class=p>();</span>
</span></code></pre></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../flink-sql-2/ class="md-footer__link md-footer__link--prev" aria-label="Previous: SQL DML"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> SQL DML </div> </div> </a> <a href=../datastream/ class="md-footer__link md-footer__link--next" aria-label="Next: DataStreams API"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> DataStreams API </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2018 - 2026 Jerome Boyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/jbcodeforce target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/jeromeboyer target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.code.annotation", "content.code.copy", "content.tooltips", "content.tabs.link", "search.suggest", "search.highlight", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>